---
title: "p8105_hw2_js6177"
author: "Jiayi Shi"
date: "2022-10-01"
output: github_document
---

```{r message=FALSE}
library(tidyverse)
```

## Problem 1

### Read and clean data

The code below read and do some cleaning after viewing the original data.
```{r}
transit_data = read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>% 
  select(2:5, starts_with("route"), entry, vending, entrance_type, ada_compliance = ada) %>% 
  mutate(
    entry = recode(entry,"YES"=TRUE,"NO"=FALSE),
  )
```

* Cleaning steps

After loading the data, I clean the variables' names using `janitor::clean_names()` and select the required variables for a new dataset `transit_data`, including `line`, `station_name`, `station_latitude`, `station_longitude`, `route1-11`, `entry`, `vending`, `entrance_type`, and `ada_compliance`. Next, I convert the `entry` from character (`YES` & `NO`) to a logical variable (`TRUE` & `FALSE`). The dimension of the resulting dataset is `r dim(transit_data)[1]` x `r dim(transit_data)[2]`. 

These data are still not tidy enough from my perspective. First, the route containing many missing values can be further cleaned. Furthermore, the vending variable can be converted to logic variable and there are repeated rows in the dataset.


```{r}
dist_station = distinct(transit_data, line, station_name, .keep_all = T)
```

* There are `r nrow(dist_station)` distinct stations.  
* `r nrow(filter(dist_station,ada_compliance==T))` stations are ADA compliant. 
* `r round(nrow(filter(transit_data,vending == "NO", entry == TRUE))/nrow(transit_data)*100,2)`% station entrances / exits without vending allow entrance.

### Reformat data

I convert the `route8-11` from numeric to character variables as `route1-7` so as to use `pivot_longer` to make route number and route name distinct variables. In this step, I also drop the NA value. Finally, I relocate columns in the dataset `transit_data_ref` as the problem specified. 

```{r}
transit_data_ref = 
  mutate_at(transit_data, c("route8","route9","route10","route11"),as.character) %>% 
  pivot_longer(
    starts_with("route"),
    names_to = "route_number",
    names_prefix = "route",
    values_to = "route_name",
    values_drop_na = T
  ) %>%
  select(1:4, route_number, route_name, everything()) %>% 
  mutate(route_number = as.numeric(route_number))

dist_station_ref = distinct(transit_data_ref, line, station_name, .keep_all = T)
```

* There are `r nrow(filter(dist_station_ref,route_name=="A"))` stations serving the A train, and `r nrow(filter(dist_station_ref,route_name=="A", ada_compliance==T))` of them are ADA compliant.

